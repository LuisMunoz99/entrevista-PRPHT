---
title: "entrevista-PRPHT"
author: "Luis Muñoz"
date: '2024-03-13'
output: html_document
editor_options: 
  markdown: 
---
```{r setup}
knitr::opts_chunk$set(include = FALSE)
options(
  knitr.messages = FALSE,
  knitr.warnings = FALSE
)

if(!require(pacman))install.packages("pacman")
p_load(dplyr, 
       here,
       readxl,
       stringr
       kableExtra)
```
### Documento presenta la primera parte del ejercicio de practica par a la entrevista a la posición de analista de datos ("data specialist") por el fideicomiso de salud publica. 

## Importación de datos
```{r import_data, echo=TRUE}
# Importación de datos
args <- list(input = here("exercise/input/Datos para ejercicio práctico-Data Specialist.xlsx"))
             
datos_PRPHT_orig <- read_excel(args$input)

datos_PRPHT <- datos_PRPHT_orig
```

## Limpieza de datos preliminar
```{r data_cleaning, include=FALSE}
# Revision
head(datos_PRPHT) 
summary(datos_PRPHT) 
str(datos_PRPHT)

## Verificar duplicados
duplicated(datos_PRPHT)

## Verificar valores unicos en cada variable
lapply(datos_PRPHT, unique)
```

Se realizará una limpieza preliminar estandar de los datos:

1. **Eliminación de espacios adicionales:** Se eliminarán los espacios adicionales que puedan estar presentes al principio o al final de las palabras en todo el banco de datos.

2. **Normalización de mayúsculas y minúsculas:** Se cambiarán todas las palabras a minúsculas y se capitalizará únicamente la primera letra de cada palabra.

3. **Cambio de tipo de dato:** Dado que la mayoría de las categorías son definidas, se cambiará el tipo de dato de las variables categóricas de tipo caracter a factor.

Nota: La variable fecha_referido esta en el formato correcto y almacena información temporal

```{r echo=TRUE}
# Implementación de cambios
datos_PRPHT <- datos_PRPHT %>%
  mutate_all(~str_squish(.)) %>% # Eliminar espacios adicionales
  mutate_all(~str_to_sentence(.)) %>% # Capitalizar primera letra
  mutate_all(na_if, "NA") %>% # Caracteres a NA values
  mutate_at(vars(-fecha_referido), as.factor) # Tipo factor exepto fecha_referido 

```

## Preguntas


### 1. ¿Cuántos tipos de referidos se realizaron? 
Según los datos recopilados, se observa que se documentaron *`r datos_PRPHT %>%  group_by(tipo_referido) %>% summarise(n = n()) %>% n_distinct()`* tipos de referidos: "Condición de salud" y "Servicios sociales".
```{r data_analysis, echo=FALSE}
datos_PRPHT %>% 
  group_by(tipo_referido) %>% 
  summarise(n = n()) %>% 
  n_distinct()

datos_PRPHT %>% distinct(tipo_referido)
```


### 2. ¿Cuántos referidos de condición de salud se documentaron? 
```{r include=FALSE}
total_referidos <- datos_PRPHT %>% 
  summarise(total_referidos = sum(!is.na(tipo_referido)))


referidos_condicion_salud <- datos_PRPHT %>%
  filter(tipo_referido == "Condición de salud") %>%
  summarise(count = n())
```
Según la variable de tipos de referidos, se registraron un total de **`r total_referidos`** referidos. De estos, **`r referidos_condicion_salud`** están relacionados exclusivamente con referidos por condición de salud.
```{r echo=FALSE}
datos_PRPHT %>% group_by(tipo_referido) %>% 
  summarise(n = n()) %>% kable("html") %>%
  kable_styling()
```


### 3. ¿Cuáles servicios sociales se identificaron en el Municipio de Culebra?
```{r message=FALSE, warning=FALSE, include=FALSE}
total_referidos_culebra <- datos_PRPHT %>% filter(municipio_rs == "Culebra") %>% 
  summarise(count = n())

servicios_sociales_culebra <- datos_PRPHT %>% 
  filter(municipio_rs == "Culebra" & tipo_referido == "Servicios sociales") %>% 
  summarise(n = n())
```
En el municipio de Culebra se registraron un total de **`r total_referidos_culebra`** referidos. De estos, **`r servicios_sociales_culebra`** correspondena servicios sociales. **Los servicios sociales identificados en Culebra fueron "Alimentos" y "Empleo o ingresos".**
```{r echo=FALSE, message=FALSE, warning=FALSE}
datos_PRPHT %>% 
  group_by(municipio_rs,tipo_referido,servicios_sociales) %>% 
  summarise(n = n()) %>% 
  filter(municipio_rs == "Culebra") %>% 
   kable("html") %>%
  kable_styling()
```


### 4. Evalué las variables llamadas: `municipio_rs`, `condicion_salud` y `tipo_referido` e identifiqué incongruencias o errores. De encontrar incongruencias o errores explique cuales son, y cómo mejorar la recopilación de datos para que no vuelvan a ocurrir esos errores. 


#### Variable: `municipio_rs`
Se observan valores que no corresponden a municipios de Puerto Rico, como "New York" y "San Luis". Estos valores pueden ser errores o inconsistencias en los datos que necesitan ser corregidos.
```{r echo=FALSE, warning=FALSE}
# Identificación de incongruencias o errores
datos_PRPHT %>% distinct(municipio_rs) %>%  
  arrange(desc(municipio_rs))  # Errores convertirlos a valores NA 
```


#### Variable: `condición_salud`
Se observan errores ortográficos y categorías que no se ajustan a la lógica esperada en la variable. Categorías como "Servicios de ama de llaves" y "Deuda en el servicio de energía" no parecen corresponder a condiciones de salud. Es necesario revisar y corregir estas categorías.
```{r echo=FALSE, warning=FALSE}
datos_PRPHT %>% distinct(condicion_salud) %>% 
  arrange(desc(condicion_salud))   # Errores a corregir y otros a valores NA
```


#### Variable: `tipo_referido`
No se observan errores en las categorias de esta variable. Las categorías son apropiadas.
```{r echo=FALSE, warning=FALSE}
datos_PRPHT %>% distinct(tipo_referido) # No errores
```


#### Recomendaciones sobre cómo mejorar la recopilación de datos para que no vuelvan a ocurrir esos errores. 

1. **Establecer categorías predeterminadas**: Recomiendo proveer categorías predeterminadas en las variables para evitar respuestas abiertas que dependan de la interpretación del entrevistador o de la persona encuestada.  Por ejemplo, en la variable "municipio_rs", se podría ofrecer opciones específicas para los municipios de Puerto Rico. 

Además, sería útil incluir una categoría "otro" para recopilar respuestas que no coincidan con las categorías predefinidas. También se podría agregar una categoría "No aplica" para respuestas que no sean pertinentes al alcance de la investigación. Ambas opciones ("Otro" y "No aplica") podrían utilizarse para recopilar información que no cumpla con el formato deseado, y luego podrían ser revisadas y ajustadas según sea necesario. Esto ayudaría a mantener la lógica en las respuestas y simplificaría el análisis de los datos recopilados.

2. **Secciones obligatorias**  Recomiendo implementar secciones obligatorias al cuestionario para reducir los valores faltantes. Los entrevistadores o encuestados estarían obligados a completar ciertas partes del cuestionario antes de poder enviarlo, lo que garantizaría una recopilación de datos mas completa. 

3. **Validación de datos durante proceso de recolección de datos**: Recomiendo implementar validaciones en tiempo real en el formulario durante el proceso de recolección de datos. Esto implica establecer restricciones y formatos específicos para variables como fecha y municipio, así como reglas lógicas y criterios predeterminados de manera que los valores deberán cumplir para ser ingresados. Estas precauciones permitiran que cualquier persona que siga los protocolos establecidos, estará realizando un ejercicio de recopilación de datos consistente y producirá datos de calidad.

4. **Asegurar claridad y objetividad en las preguntas y categorías**: Es esencial garantizar que las preguntas y categorías del cuestionario sean claras y objetivas para evitar interpretaciones por parte del entrevistador o del encuestado. Para lograr esto, se pueden seguir algunas prácticas, como utilizar un lenguaje sencillo y directo, evitar términos ambiguos, y definir y explicar claramente cada categoría para evitar confusiones.  Los datos recopilados deben ser consistentes independientemente del entrevistador.

5. **Entrenamiento del personal**: Recomiendo capacitar al personal responsable de la recolección de datos sobre las mejores prácticas de recopilación de datos para garantizar la calidad de los mismos. Además, es importante orientar al entrevistador sobre el propósito y la lógica de cada variable para que pueda discernir sobre respuestas que no se ajusten a la lógica esperada. Esto asegurará un proceso riguroso que permitira obtener datos precisos y de calidad para el estudio.


### 5.	Cree categorías para la variable condicion_salud
Propongo crear categorías para la variable `condicion_salud` con el fin de corregir errores de ortografía y ajustar aquellas que no siguen la lógica esperada. Los errores ortográficos serán corregidos, mientras que aquellos valores que no se ajusten a la lógica esperada serán marcados como NA para su revisión y corrección posterior. Otra opción podría ser asignar estos valores NA como "otros".

Además, realizaré cambios en la variable `municipio_rs` para corregir los valores que no corresponden a municipios de Puerto Rico. Estos valores serán convertidos en NA para su revisión y corrección posterior.

```{r}
# Implementación de cambios 

## Cambios en variable condición salud
datos_PRPHT <- datos_PRPHT %>%  
  mutate(condicion_salud = 
           case_when(str_detect(condicion_salud, "^Nutri") ~ "Nutrición", 
                     condicion_salud %in% c("Servicios de ama de llaves",
                                            "Deuda en el servicio de energia electrica") ~  NA, 
                     TRUE ~ condicion_salud))

## Cambios en variable municipio_rs
datos_PRPHT <- datos_PRPHT %>% 
    mutate(municipio_rs = 
             case_when(municipio_rs %in% c("La plata", "Nueva york", "San luis") ~  NA,
                     TRUE ~ municipio_rs))

## Revisión de cambios 
datos_PRPHT %>% select(objectid,municipio_rs,condicion_salud) %>% head()
```


